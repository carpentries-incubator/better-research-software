<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Building Better Research Software: Code correctness &amp; testing</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>


      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/06-code-correctness.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Building Better Research Software
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Building Better Research Software
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="installation-instructions.html">Installation instructions</a></li><li><a class="dropdown-item" href="reproducible-research-discussion.html">Reproducible Research Discussion</a></li><li><a class="dropdown-item" href="fair-software.html">FAIR Research Software</a></li><li><a class="dropdown-item" href="test-suite-exercise.html">Implementing a test suite</a></li><li><a class="dropdown-item" href="ci-for-testing.html">Continuous Integration for automated testing</a></li><li><a class="dropdown-item" href="licensing.html">Software licensing</a></li><li><a class="dropdown-item" href="ethical-environmental-considerations.html">Ethical &amp; environmental considerations around research software</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Building Better Research Software
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 48%" class="percentage">
    48%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 48%" aria-valuenow="48" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/06-code-correctness.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Course introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-better-start-version-control.html">2. Better start with a software project</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-reproducible-dev-environment.html">3. Reproducible software environments</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-code-readability.html">4. Code readability</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-code-structure.html">5. Code structure</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Code correctness &amp; testing
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#why-use-software-testing">Why use software testing?</a></li>
<li><a href="#types-of-software-tests">Types of software tests</a></li>
<li><a href="#informal-testing">Informal testing</a></li>
<li><a href="#formal-testing">Formal testing</a></li>
<li><a href="#testing-frameworks">Testing frameworks</a></li>
<li><a href="#test-suite-design">Test suite design</a></li>
<li><a href="#continuous-integration-for-automated-testing">Continuous Integration for automated testing</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#further-reading">Further reading</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-software-documentation.html">7. Software documentation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-open-collaboration.html">8. Software management &amp; collaboration</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-wrap-up.html">9. Wrap-up</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="installation-instructions.html">Installation instructions</a></li><li><a href="reproducible-research-discussion.html">Reproducible Research Discussion</a></li><li><a href="fair-software.html">FAIR Research Software</a></li><li><a href="test-suite-exercise.html">Implementing a test suite</a></li><li><a href="ci-for-testing.html">Continuous Integration for automated testing</a></li><li><a href="licensing.html">Software licensing</a></li><li><a href="ethical-environmental-considerations.html">Ethical &amp; environmental considerations around research software</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-code-structure.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-software-documentation.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-code-structure.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code structure
        </a>
        <a class="chapter-link float-end" href="07-software-documentation.html" rel="next">
          Next: Software...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Code correctness &amp; testing</h1>
        <p>Last updated on 2025-12-05 |

        <a href="https://github.com/carpentries-incubator/better-research-software/edit/main/episodes/06-code-correctness.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we verify that our code is correct?</li>
<li>How can we automate our software tests?</li>
<li>What makes a “good” test?</li>
<li>Which parts of our code should we prioritise for testing?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul><li>Explain why code testing is important and how this improves software
quality.</li>
<li>Describe the different types of software tests (unit tests,
integration tests, regression tests).</li>
<li>Implement unit tests to verify that function behave as expected
using the Python testing framework <code>pytest</code>.</li>
<li>Interpret the output from <code>pytest</code> to identify which
functions are not behaving as expected.</li>
<li>Write tests using typical values, edge cases and invalid inputs to
ensure that the code can handle extreme values and invalid inputs
appropriately.</li>
<li>Evaluate code coverage to identify how much of the codebase is being
tested and identify areas that need further tests.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Now that we have improved the structure and readability of our code -
it is much easier to test its functionality and improve it further. The
goal of software testing is to check that the actual results produced by
a piece of code meet our expectations, i.e. are correct.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Code state </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>At this point, the code in your local software project’s directory
should be as in: <a href="https://github.com/carpentries-incubator/bbrs-software-project/tree/06-code-correctness" class="external-link uri">https://github.com/carpentries-incubator/bbrs-software-project/tree/06-code-correctness</a></p>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Activate your virtual environment </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<p>If it is not already active, make sure to activate your virtual
environment from the root of the software project directory:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> source venv_spacewalks/bin/activate <span class="co"># Mac or Linux</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">$</span> source venv_spacewalks/Scripts/activate <span class="co"># Windows</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="why-use-software-testing">Why use software testing?<a class="anchor" aria-label="anchor" href="#why-use-software-testing"></a></h2>
<hr class="half-width"><p>Including testing in our research workflow helps us to produce
<strong>better software</strong> and conduct <strong>better
research</strong>:</p>
<ul><li>Software testing can help us be more productive as it helps us to
identify and fix problems with our code early and quickly and allows us
to demonstrate to ourselves and others that our code does what we claim.
More importantly, we can share our tests alongside our code, allowing
others to verify our software for themselves.</li>
<li>The act of writing tests encourages to structure our code as
individual functions and often results in a more
<strong>readable</strong>, modular and maintainable codebase that is
easier to extend or repurpose.</li>
<li>Software testing improves the <strong>accessibility</strong> and
<strong>reusability</strong> of our code - well-written software tests
capture the expected behaviour of our code and can be used alongside
documentation to help other developers quickly make sense of our code.
In addition, a well tested codebase allows developers to experiment with
new features safe in the knowledge that tests will reveal if their
changes have broken any existing functionality.</li>
<li>By demonstrating that our code works as expected and produces
accurate results, software testing can give us the confidence to share
our code with others. Software testing brings peace of mind by providing
a step-by-step approach that we can apply to verify that our code is
correct.</li>
</ul></section><section><h2 class="section-heading" id="types-of-software-tests">Types of software tests<a class="anchor" aria-label="anchor" href="#types-of-software-tests"></a></h2>
<hr class="half-width"><p>There are many different types of software tests, including:</p>
<ul><li><p><strong>Unit tests</strong> focus on testing individual functions
in isolation. They ensure that each small part of the software performs
as intended. By verifying the correctness of these individual units, we
can catch errors early in the development process.</p></li>
<li><p><strong>Integration tests</strong> check how different parts of
the code e.g. functions work together.</p></li>
<li><p><strong>Regression tests</strong> are used to ensure that new
changes or updates to the codebase do not adversely affect the existing
functionality. They involve checking whether a program or part of a
program still generates the same results after changes have been
made.</p></li>
<li><p><strong>End-to-end</strong> tests are a special type of
integration testing which checks that a program as a whole behaves as
expected.</p></li>
</ul><p>In this course, our primary focus will be on unit testing. However,
the concepts and techniques we cover will provide a solid foundation
applicable to other types of testing.</p>
<div id="types-of-software-tests-3-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="types-of-software-tests-3-min" class="callout-inner">
<h3 class="callout-title">Types of software tests (3 min)</h3>
<div class="callout-content">
<p>Fill in the blanks in the sentences below:</p>
<ul><li>__________ tests compare the ______ output of a program to its
________ output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a ______ ________ to the
expected output to demonstrate correctness.</li>
<li>__________ tests check that results have not changed since the
previous test run.</li>
<li>__________ tests check that two or more parts of a program are
working together correctly.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ul><li>End-to-end tests compare the actual output of a program to the
expected output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a single function to the
expected output to demonstrate correctness.</li>
<li>Regression tests check that results have not changed since the
previous test run.</li>
<li>Integration tests check that two or more parts of a program are
working together correctly.</li>
</ul></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="informal-testing">Informal testing<a class="anchor" aria-label="anchor" href="#informal-testing"></a></h2>
<hr class="half-width"><p>How should we test our code? One approach is to copy/paste the code
or a function into a Python terminal - <em>different from a command line
terminal</em> - which allows you to interact with the Python interpreter
more directly. From the Python terminal we can then run one function or
a piece of code at a time and check that they behave as expected. As
input to our code/function we are testing, we typically use some input
values for which we know what the correct return value should be.</p>
<p>Let’s do this for our <code>text_to_duration</code> function. Recall
that the <code>text_to_duration</code> function converts a spacewalk
duration stored as a string in format “HH:MM” to a duration in decimal
hours - e.g. duration <code>01:15</code> (1 hour and 15 minutes) should
return a numerical decimal value of <code>1.25</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> text_to_duration(duration):</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">    Convert a text format duration "HH:MM" to duration in hours</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">        duration (str): The text format duration</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">        duration_hours (float): The duration in hours</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    hours, minutes <span class="op">=</span> duration.split(<span class="st">":"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">6</span>  <span class="co"># there is an intentional bug on this line (should divide by 60 not 6)</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    <span class="cf">return</span> duration_hours</span></code></pre>
</div>
<p>To start a Python terminal, you simply type <code>python3</code>
(with no other parameters) from the root directory of your project in a
command line terminal.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span><span class="ex">$</span> python3</span></code></pre>
</div>
<p>This will open an interactive Python terminal for you, which may look
like this:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>Python <span class="fl">3.14.0</span> (main, Oct  <span class="dv">7</span> <span class="dv">2025</span>, <span class="dv">0</span><span class="er">9</span>:<span class="dv">34</span>:<span class="dv">52</span>) [Clang <span class="fl">17.0.0</span> (clang<span class="op">-</span><span class="fl">1700.0.13.3</span>)] on darwin</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>Type <span class="st">"help"</span>, <span class="st">"copyright"</span>, <span class="st">"credits"</span> <span class="kw">or</span> <span class="st">"license"</span> <span class="cf">for</span> more information.</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> </span></code></pre>
</div>
<p>Once inside the Python terminal, you can start typing Python code.
The Python terminal will interactively run your code and return and
print results. We could copy and paste the code of our
<code>text_to_duration</code> function, but it is much simpler and more
elegant to import and then invoke it.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> text_to_duration(<span class="st">"10:00"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fl">10.0</span></span></code></pre>
</div>
<p>So, we have invoked our function with the value “10:00” and it
returned the floating point value “10.0” as expected.</p>
<p>We can then further explore the behaviour of our function by
running:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> text_to_duration(<span class="st">"00:00"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fl">0.0</span></span></code></pre>
</div>
<p>This all seems correct so far.</p>
<p>Testing code in this “informal” way in an important process to go
through as we draft our code for the first time. Another tool that can
help here is the <a href="https://jupyter.org/" class="external-link">Jupyter Notebook</a> -
like the Python terminal, the Jupyter Notebook is an interactive
environment for writing and running code. It is a GUI tool which
supports all kinds of interactive outputs, including many interactive
visualisation libraries.</p>
<p>However, there are some serious drawbacks to this approach if used as
our only form of testing.</p>
<div id="what-are-the-limitations-of-informally-testing-code-5-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="what-are-the-limitations-of-informally-testing-code-5-min" class="callout-inner">
<h3 class="callout-title">What are the limitations of informally testing
code? (5 min)</h3>
<div class="callout-content">
<p>Think about the questions below. Your instructors may ask you to
share your answers in a shared notes document and/or discuss them with
other participants.</p>
<ul><li>Why might we choose to test our code informally?</li>
<li>What are the limitations of relying solely on informal tests to
verify that a piece of code is behaving as expected?</li>
</ul></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>It can be tempting to test our code informally because this
approach:</p>
<ul><li>is quick and easy</li>
<li>provides immediate feedback</li>
</ul><p>However, there are limitations to this approach:</p>
<ul><li>Working interactively is error prone</li>
<li>We must reload our function in Python terminal each time we change
our code</li>
<li>We must repeat our tests every time we update our code which is time
consuming</li>
<li>We must rely on memory to keep track of how we have tested our code,
e.g. what input values we tried</li>
<li>We must rely on memory to keep track of which functions have been
tested and which have not (informal testing may work well on smaller
pieces of code but it becomes unpractical for a large codebase)</li>
<li>Once we close the Python terminal, we lose all the test scenarios we
have tried</li>
</ul></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="formal-testing">Formal testing<a class="anchor" aria-label="anchor" href="#formal-testing"></a></h2>
<hr class="half-width"><p>We can overcome some of these limitations by formalising our testing
process. A formal approach to testing our code is to write dedicated
test functions to check it. These test functions:</p>
<ul><li>Run the function we want to test - the target function with known
inputs</li>
<li>Compare the output to known, valid results</li>
<li>Raise an error if the function’s actual output does not match the
expected output</li>
<li>Are recorded in a test script that can be re-run on demand.</li>
</ul><p>Let’s explore this process by writing some formal tests for our
<code>text_to_duration</code> function.</p>
<p>In VS Code, create a new Python file <code>test_code.py</code> in the
root of our project directory to store our tests.</p>
<p>Like before in the Python terminal, we need to import
<code>text_to_duration</code> into our test script. Then, we add our
first test function:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    input_value <span class="op">=</span> <span class="st">"10:00"</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    test_result <span class="op">=</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"text_to_duration('10:00') == 10? </span><span class="sc">{</span>test_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>test_text_to_duration_integer()</span></code></pre>
</div>
<p>We can run this code from the command line terminal as:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span><span class="ex">$</span> python3 test_code.py </span></code></pre>
</div>
<p>We should get the following output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fu">text_to_duration</span><span class="op">(</span><span class="st">'10:00'</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10</span><span class="op">?</span> <span class="va">True</span></span></code></pre>
</div>
<p>This test checks that when we apply <code>text_to_duration</code> to
input value <code>10:00</code>, the output matches the expected value of
<code>10</code>.</p>
<p>In this example, we use a print statement to report whether the
actual output from <code>text_to_duration</code> meets our
expectations.</p>
<p>However, this does not meet our requirement to “Raise an error if the
function’s output does not match the expected output” and means that we
must carefully read our test function’s output to identify whether it
has failed.</p>
<p>To ensure that our code raises an error if the function’s output does
not match the expected output, we use Python’s <code>assert</code>
statement. The <code>assert statement</code> in Python checks whether a
condition is <code>True</code> or <code>False</code>. If the statement
is <code>True</code>, <code>assert</code> does not return a value and
the code continues to run. However, if the statement is
<code>False</code>, <code>assert</code> raises an
<code>AssertError</code>.</p>
<p>Let’s rewrite our test with an <code>assert</code> statement:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>test_text_to_duration_integer()</span></code></pre>
</div>
<p>Notice that when we run <code>test_text_to_duration_integer()</code>,
nothing happens - there is no output. That is because our function is
working correctly and returning the expected value of 10.</p>
<p>Let’s add another test to check what happens when duration is not an
integer number and if our function can handle durations with a non-zero
minute component, and rerun our test code.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:15"</span>) <span class="op">==</span> <span class="fl">10.25</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>test_text_to_duration_float()</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>test_text_to_duration_integer()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>(venv_spacewalks) $ python3 test_code.py
Traceback (most recent call last):
  File "/Users/user/Desktop/spacewalks/test_code.py", line 9, in &lt;module&gt;
    test_text_to_duration_float()
  File "/Users/user/Desktop/spacewalks/test_code.py", line 4, in test_text_to_duration_float
    assert text_to_duration("10:15") == 10.25
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError</code></pre>
</div>
<p>Notice that this time, our test
<code>test_text_to_duration_float</code> fails. Our assert statement has
raised an <code>AssertionError</code> - a clear signal that there is a
problem in our code that we need to fix.</p>
<p>We know that duration <code>10:15</code> (10 hours and 15 minutes)
should be converted to a decimal number <code>10.25</code>. What is
wrong with our code? If we look at our <code>text_to_duration</code>
function, we may identify the following line of our code as
problematic:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">def</span> text_to_duration(duration):</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    ...</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">6</span> </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    ...</span></code></pre>
</div>
<p>You may notice that we have introduced a bug in one of the earlier
episodes when we refactored the code - the minutes component should have
been divided by 60 and not 6.</p>
<p>This is quite <em>critical</em> - our code was running (seemingly) OK
(i.e. it did not fail) and was producing the graph which we could not
tell was wrong just by looking at it as this was a subtle bug. We were
only able to uncover this bug <strong>by properly testing our
code</strong>.</p>
<p>Let’s fix the problematic line in <code>eva_data_analysis.py</code>
and rerun out tests.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>...</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">60</span> </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>...</span></code></pre>
</div>
<p>This time our tests run without problem.</p>
<p>Should we add more tests or the tests we have so far are enough? What
happens if our duration value is <code>10:20</code> (ten hours and 20
minutes) and our result is not a rational floating point number (like
<code>10.25</code>) but an irrational number such as
<code>10.333333333</code>? Let’s tests for this.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:20"</span>) <span class="op">==</span> <span class="fl">10.33333333</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>test_text_to_duration_float()</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>test_text_to_duration_integer()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>(venv_spacewalks) $ python3 test_code.py
Traceback (most recent call last):
  File "/Users/user/work/SSI/lessons/astronaut-data-analysis/test_code.py", line 17, in &lt;module&gt;
    test_text_to_duration_float()
  File "/Users/user/work/SSI/lessons/astronaut-data-analysis/test_code.py", line 9, in test_text_to_duration_float
    assert text_to_duration("10:20") == 10.33333333
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError</code></pre>
</div>
<p>Our test is failing again - what is wrong now?</p>
<p>On computer systems, representation of irrational numbers is
typically not exact as they do not have an exact binary representation.
For this reason, we cannot use a simple double equals sign
(<code>==</code>) to compare the equality of floating point numbers.
Instead, we check that our floating point numbers are equal within a
very small tolerance (e.g. 1e-5). Hence, our code should look like:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>...</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">abs</span>(text_to_duration(<span class="st">"10:20"</span>) <span class="op">-</span> <span class="fl">10.33333333</span>) <span class="op">&lt;</span> <span class="fl">1e-5</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>...</span></code></pre>
</div>
<p>You may have noticed that we have to repeat a lot of code to add each
individual test for each test case. You may also have noticed that our
test script stopped after the first test failure and none of the tests
after that were run. To run our remaining tests we would have to
manually comment out our failing test and re-run the test script. As our
code base grows, testing in this way becomes cumbersome and error-prone.
These limitations can be overcome by automating our tests using a
<strong>testing framework</strong>.</p>
</section><section><h2 class="section-heading" id="testing-frameworks">Testing frameworks<a class="anchor" aria-label="anchor" href="#testing-frameworks"></a></h2>
<hr class="half-width"><p>Testing frameworks can automatically find all the tests in our code
base, run all of them (so we do not have to invoke them explicitly or,
even worse, forget to invoke them), and present the test results as a
readable summary.</p>
<p>We will use the Python testing framework <code>pytest</code> with its
code coverage extension <code>pytest-cov</code>. To install these
libraries into our virtual environment, from the command line terminal
do:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python3 <span class="at">-m</span> pip install pytest pytest-cov</span></code></pre>
</div>
<p>Let’s make sure that our tests are ready to work with
<code>pytest</code>.</p>
<ul><li>
<p><code>pytest</code> automatically discovers tests based on
specific naming patterns. It looks for files that start with
<code>test_</code> or end with <code>_test.py</code>. Then, within these
files, <code>pytest</code> looks for functions that start with
<code>test_</code>. Our test file already meets these requirements, so
there is nothing to do here. However, our script does contain lines to
run each of our test functions. These are no-longer required as
<code>pytest</code> will run our tests so we can remove them:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Delete these 2 lines</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>test_text_to_duration_float()</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>test_text_to_duration_integer()</span></code></pre>
</div>
</li>
<li><p>It is also conventional when working with a testing framework to
place test files in a <code>tests</code> directory at the root of our
project and to name each test file after the code file that it targets.
This helps in maintaining a clean structure and makes it easier for
others to understand where the tests are located.</p></li>
</ul><p>A set of tests for a given piece of code is called a test suite. Our
test suite is currently located in the root folder of our project. Let’s
move it to a dedicated test folder and rename our
<code>test_code.py</code> file to <code>test_eva_analysis.py</code>.</p>
<p>You can do it from VS Code or by typing the following commands in the
command line terminal:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> mkdir tests</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> mv test_code.py tests/test_eva_analysis.py</span></code></pre>
</div>
<p>Before we re-run our tests using <code>pytest</code>, let’s update
our second test to use <code>pytest</code>’s function
<code>approx()</code> which is specifically intended for comparing
floating point numbers within a tolerance.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:20"</span>) <span class="op">==</span> pytest.approx(<span class="fl">10.33333333</span>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span></code></pre>
</div>
<p>Let’s also add some inline comments to clarify what each test is
doing and expand our syntax to highlight the logic behind our
approach:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="co">    for typical durations with a non-zero minute component</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>    actual_result <span class="op">=</span> text_to_duration(<span class="st">"10:20"</span>) </span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="fl">10.33333333</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> pytest.approx(expected_result)</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>    </span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="co">    for typical whole hour durations </span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>    actual_result <span class="op">=</span>  text_to_duration(<span class="st">"10:00"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>    </span></code></pre>
</div>
<p>Writing our tests this way highlights the key idea that each test
should compare the actual results returned by our function with expected
values.</p>
<p>Similarly, writing inline comments for our tests that complete the
sentence “Test that …” helps us to understand what each test is doing
and why it is needed.</p>
<p>We can now run our tests with <code>pytest</code> from our project’s
root directory (not from the <code>tests</code> directory):</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python3 <span class="at">-m</span> pytest </span></code></pre>
</div>
<p>Let’s now reintroduce our old bug in function
<code>text_to_duration</code> that affects the durations with a non-zero
minute component like “10:20” but not those that are whole hours,
e.g. “10:00”:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>    ...</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">6</span>  <span class="co"># Divide by 6 instead of 60</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    ...</span></code></pre>
</div>
<p>Let’s re-run our tests with <code>pytest</code> from our project’s
root directory (not from the <code>tests</code> directory):</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python3 <span class="at">-m</span> pytest </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>========================================== test session starts ===========================================
platform darwin -- Python 3.11.7, pytest-8.3.3, pluggy-1.5.0
rootdir: /Users/user/work/SSI/lessons/astronaut-data-analysis-not-so-good
plugins: cov-5.0.0
collected 2 items

tests/test_eva_analysis.py F.                                                                                                                                                                                                                                                                                           [100%]

================================================ FAILURES ================================================
________________________________________ test_text_to_duration_float _____________________________________

    def test_text_to_duration_float():
&gt;       assert text_to_duration("10:20") == pytest.approx(10.33333333)
E       assert 13.333333333333334 == 10.33333333 ± 1.0e-05
E
E         comparison failed
E         Obtained: 13.333333333333334
E         Expected: 10.33333333 ± 1.0e-05

tests/test_eva_analysis.py:5: AssertionError
=========================================== short test summary info =======================================
FAILED tests/test_eva_analysis.py::test_text_to_duration_float - assert 13.333333333333334 == 10.33333333 ± 1.0e-05
========================================= 1 failed, 1 passed in 0.67s =====================================
</code></pre>
</div>
<p>From the above output from <code>pytest</code>’s execution of out
tests, we notice that:</p>
<ul><li>If a test function finishes without triggering an assertion, the
test is considered successful and is marked with a dot
(<code>.</code>).</li>
<li>If an assertion fails or an error occurs, the test is marked as a
failure with an <code>F</code>, and the output includes details about
the error to help identify what went wrong.</li>
</ul><p>Let’s fix our bug once again, and rerun our tests using
<code>pytest</code>.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>========================================== test session starts ===========================================
platform darwin -- Python 3.11.7, pytest-8.3.3, pluggy-1.5.0
rootdir: /Users/user/work/SSI/lessons/astronaut-data-analysis-not-so-good
plugins: cov-5.0.0
collected 2 items

tests/test_eva_analysis.py ..                                                                                                                                                                                                                                                                                           [100%]

=========================================== 2 passed in 0.63s =============================================</code></pre>
</div>
<p>This time, all our tests passed.</p>
<div id="interpreting-pytest-output-15-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="interpreting-pytest-output-15-min" class="callout-inner">
<h3 class="callout-title">Interpreting pytest output (15 min)</h3>
<div class="callout-content">
<p>A colleague has asked you to conduct a pre-publication review of
their code which analyses time spent in space by various individual
astronauts.</p>
<p>You tested their code using <code>pytest</code>, and got the
following output. Inspect it and answer the questions below.</p>
<div class="section level4">
<h4 id="example-pytest-output">Example <code>pytest</code> output<a class="anchor" aria-label="anchor" href="#example-pytest-output"></a></h4>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>============================================================ test session starts
platform darwin -- Python 3.12.3, pytest-8.2.2, pluggy-1.5.0
rootdir: /Users/Desktop/AnneResearcher/projects/Spacetravel
collected 9 items

tests/test_analyse.py FF....                                              [ 66%]
tests/test_prepare.py s..                                                 [100%]

====================================================================== FAILURES
____________________________________________________________ test_total_duration

    def test_total_duration():

      durations = [10, 15, 20, 5]
      expected  = 50/60
      actual  = calculate_total_duration(durations)
&gt;     assert actual == pytest.approx(expected)
E     assert 8.333333333333334 == 0.8333333333333334 ± 8.3e-07
E
E       comparison failed
E       Obtained: 8.333333333333334
E       Expected: 0.8333333333333334 ± 8.3e-07

tests/test_analyse.py:9: AssertionError
______________________________________________________________________________ test_mean_duration

    def test_mean_duration():
       durations = [10, 15, 20, 5]

       expected = 12.5/60
&gt;      actual  = calculate_mean_duration(durations)

tests/test_analyse.py:15:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

durations = [10, 15, 20, 5]

    def calculate_mean_duration(durations):
        """
        Calculate the mean of a list of durations.
        """
        total_duration = sum(durations)/60
&gt;       mean_duration = total_duration / length(durations)
E       NameError: name 'length' is not defined

Spacetravel.py:45: NameError
=========================================================================== short test summary info
FAILED tests/test_analyse.py::test_total_duration - assert 8.333333333333334 == 0.8333333333333334 ± 8.3e-07
FAILED tests/test_analyse.py::test_mean_duration - NameError: name 'length' is not defined
============================================================== 2 failed, 6 passed, 1 skipped in 0.02s </code></pre>
</div>
<ol style="list-style-type: lower-alpha"><li>How many tests has our colleague included in the test suite?</li>
<li>The first test in <code>test_prepare.py</code> has a status of
<code>s</code>; what does this mean (search online to find out)?</li>
<li>How many tests failed?</li>
<li>Why did <code>test_total_duration</code> fail?</li>
<li>Why did <code>test_mean_duration</code> fail?</li>
</ol></div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha"><li>Nine tests were detected in the test suite</li>
<li>
<code>s</code> - stands for “skipped”. Sometimes a test will be
skipped based on a condition, for example when testing on a particular
operating system.</li>
<li>Two tests failed: the first and second test in the test file
<code>test_analyse.py</code>
</li>
<li>
<code>test_total_duration</code> failed because the calculated total
duration differs from the expected value by a factor of 10 i.e. the
assertion <code>actual == pytest.approx(expected)</code> evaluated to
<code>False</code>
</li>
<li>
<code>test_mean_duration</code> failed because there is a syntax
error in <code>calculate_mean_duration</code>. Our colleague has used
the command <code>length</code> (not a python command) instead of
<code>len</code>. As a result, running the function raises a
<code>NameError</code> rather than returning a calculated value causing
the function to be interrupted prematurely and the test to fail.</li>
</ol></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="test-suite-design">Test suite design<a class="anchor" aria-label="anchor" href="#test-suite-design"></a></h2>
<hr class="half-width"><p>We now have the tools in place to automatically run tests. However,
that alone is not enough to properly test code. We will now look into
what makes a good test suite and good practices for testing code.</p>
<p>Let’s start by considering the following scenario. A collaborator on
our project has sent us the following code which adds a new column
called <code>crew_size</code> to our data containing the number of
astronauts participating in any given spacewalk. How do we know that it
works as intended and that it will not break the rest of our code? For
this, we need to write a test suite with a comprehensive coverage of the
new code.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="im">import</span> re <span class="co"># added this line</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="kw">def</span> main(input_file, output_file, graph_file):</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--START--"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>    <span class="co"># Read the data from JSON file</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>    eva_data <span class="op">=</span> read_json_to_dataframe(input_file)</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>    <span class="co"># Calculate and add crew size to data</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>    eva_data <span class="op">=</span> add_crew_size_column(eva_data) <span class="co"># added this line</span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>    <span class="co"># Convert and export data to CSV file</span></span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>    write_dataframe_to_csv(eva_data, output_file)</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>    <span class="co"># Sort dataframe by date ready to be plotted (date values are on x-axis)</span></span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a>    eva_data.sort_values(<span class="st">'date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>    <span class="co"># Plot cumulative time spent in space over years</span></span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a>    plot_cumulative_time_in_space(eva_data, graph_file)</span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--END--"</span>)</span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a>... </span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a><span class="kw">def</span> calculate_crew_size(crew):</span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-31"><a href="#cb29-31" tabindex="-1"></a><span class="co">    Calculate the size of the crew for a single crew entry</span></span>
<span id="cb29-32"><a href="#cb29-32" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb29-34"><a href="#cb29-34" tabindex="-1"></a><span class="co">        crew (str): The text entry in the crew column containing a list of crew member names</span></span>
<span id="cb29-35"><a href="#cb29-35" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb29-37"><a href="#cb29-37" tabindex="-1"></a><span class="co">        (int): The crew size</span></span>
<span id="cb29-38"><a href="#cb29-38" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-39"><a href="#cb29-39" tabindex="-1"></a>    <span class="cf">if</span> crew.split() <span class="op">==</span> []:</span>
<span id="cb29-40"><a href="#cb29-40" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb29-41"><a href="#cb29-41" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb29-42"><a href="#cb29-42" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(re.split(<span class="vs">r';'</span>, crew))<span class="op">-</span><span class="dv">1</span></span>
<span id="cb29-43"><a href="#cb29-43" tabindex="-1"></a></span>
<span id="cb29-44"><a href="#cb29-44" tabindex="-1"></a><span class="kw">def</span> add_crew_size_column(df):</span>
<span id="cb29-45"><a href="#cb29-45" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-46"><a href="#cb29-46" tabindex="-1"></a><span class="co">    Add crew_size column to the dataset containing the value of the crew size</span></span>
<span id="cb29-47"><a href="#cb29-47" tabindex="-1"></a></span>
<span id="cb29-48"><a href="#cb29-48" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb29-49"><a href="#cb29-49" tabindex="-1"></a><span class="co">        df (pd.DataFrame): The input data frame.</span></span>
<span id="cb29-50"><a href="#cb29-50" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb29-52"><a href="#cb29-52" tabindex="-1"></a><span class="co">        df_copy (pd.DataFrame): A copy of the dataframe df with the new crew_size variable added</span></span>
<span id="cb29-53"><a href="#cb29-53" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-54"><a href="#cb29-54" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Adding crew size variable (crew_size) to dataset'</span>)</span>
<span id="cb29-55"><a href="#cb29-55" tabindex="-1"></a>    df_copy <span class="op">=</span> df.copy()</span>
<span id="cb29-56"><a href="#cb29-56" tabindex="-1"></a>    df_copy[<span class="st">"crew_size"</span>] <span class="op">=</span> df_copy[<span class="st">"crew"</span>].<span class="bu">apply</span>(</span>
<span id="cb29-57"><a href="#cb29-57" tabindex="-1"></a>        calculate_crew_size</span>
<span id="cb29-58"><a href="#cb29-58" tabindex="-1"></a>    )</span>
<span id="cb29-59"><a href="#cb29-59" tabindex="-1"></a>    <span class="cf">return</span> df_copy</span>
<span id="cb29-60"><a href="#cb29-60" tabindex="-1"></a>...</span>
<span id="cb29-61"><a href="#cb29-61" tabindex="-1"></a>    </span></code></pre>
</div>
<div class="section level3">
<h3 id="writing-good-tests">Writing good tests<a class="anchor" aria-label="anchor" href="#writing-good-tests"></a></h3>
<p>The aim of writing good tests is to verify that each of our functions
behaves as expected with the full range of inputs that it might
encounter. It is helpful to consider each argument of a function in turn
and identify the range of typical values it can take. Once we have
identified this typical range or ranges (where a function takes more
than one argument), we should:</p>
<ul><li>Test all values at the edge of the range</li>
<li>Test at least one interior point</li>
<li>Test invalid values</li>
</ul><p>Let’s have a look at the <code>calculate_crew_size</code> function
from our colleague’s new code and write some tests for it.</p>
<div id="unit-tests-for-calculate_crew_size-10-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="unit-tests-for-calculate_crew_size-10-min" class="callout-inner">
<h3 class="callout-title">Unit tests for calculate_crew_size (10
min)</h3>
<div class="callout-content">
<p>Implement unit tests for the <code>calculate_crew_size</code>
function. Cover typical cases and edge cases.</p>
<p>Hint - use the following template when writing tests:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="kw">def</span> test_MYFUNCTION (): <span class="co"># </span><span class="al">FIXME</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co">    Test that ...   #FIXME</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>    </span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>    <span class="co"># Typical value 1</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>    actual_result <span class="op">=</span>  _______________ <span class="co">#FIXME</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>    expected_result <span class="op">=</span> ______________ <span class="co">#FIXME</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>    </span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>    <span class="co"># Typical value 2</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>    actual_result <span class="op">=</span>  _______________ <span class="co">#FIXME</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>    expected_result <span class="op">=</span> ______________ <span class="co">#FIXME</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>    </span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>We can add the following test functions to our test suite.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> (</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>    text_to_duration,</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    calculate_crew_size</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>...</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size():</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="co">    for typical crew values</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Valentina Tereshkova;"</span>)</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Judith Resnik; Sally Ride;"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a><span class="co"># Edge cases</span></span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size_edge_cases():</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a><span class="co">    for edge case where crew is an empty string</span></span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">""</span>)</span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="kw">is</span> <span class="va">None</span></span></code></pre>
</div>
<p>Let’s run our tests:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python3 <span class="at">-m</span> pytest</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="parameterising-tests">Parameterising tests<a class="anchor" aria-label="anchor" href="#parameterising-tests"></a></h3>
<p>Looking at our new test functions, we may notice that they do not
follow the <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" class="external-link">“Don’t
Repeat Yourself (DRY) principle”</a> which prevents software - including
testing code - from becoming repetitive and too long. In our test code,
a small block of code is repeated twice with different input values:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size():</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co">    for typical crew values</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Valentina Tereshkova;"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Judith Resnik; Sally Ride;"</span>)</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span></code></pre>
</div>
<p>To avoid such repetitions in our test code, we use <strong>test
parameterisation</strong>. This allows us to apply our test function to
a list of input/expected output pairs without the need for repetition.
To parameterise the <code>test_calculate_crew_size</code> function, we
can rewrite is as follows:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>...</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="at">@pytest.mark.parametrize</span>(<span class="st">"input_value, expected_result"</span>, [</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>    (<span class="st">"Valentina Tereshkova;"</span>, <span class="dv">1</span>),</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>    (<span class="st">"Judith Resnik; Sally Ride;"</span>, <span class="dv">2</span>),</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>])</span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size(input_value, expected_result):</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a><span class="co">    for typical crew values</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(input_value)</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>...</span></code></pre>
</div>
<p>Notice the following key changes to our code:</p>
<ul><li>The unparameterised version of <code>test_calculate_crew_size</code>
function did not have any arguments and our input/expected values were
all defined in the body of our test function.</li>
<li>In the parameterised version of
<code>test_calculate_crew_size</code>, the body of our test function has
been rewritten as a parameterised block of code that uses the variables
<code>input_value</code> and <code>expected_result</code> which are now
arguments of the test function.</li>
<li>A Python decorator <code>@pytest.mark.parametrize</code> is placed
immediately before the test function and indicates that it should be run
once for each set of parameters provided.</li>
</ul><div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>In Python, a decorator is a function that can modify the behaviour of
another function. <code>@pytest.mark.parametrize</code> is a decorator
provided by <code>pytest</code> that modifies the behaviour of our test
function by running it multiple times - once for each set of inputs.
This decorator takes two main arguments:</p>
<ul><li><p>Parameter names: a string with the names of the parameters that
the test function will accept, separated by commas – in this case
“input_value” and “expected_value”</p></li>
<li><p>Parameter values: a list of tuples, where each tuple contains the
values for the parameters specified in the first argument.</p></li>
</ul></div>
</div>
</div>
<p>As you can see, the parameterised version of our test function is
shorter, more readable and easier to maintain.</p>
</div>
<div class="section level3">
<h3 id="just-enough-tests">Just enough tests<a class="anchor" aria-label="anchor" href="#just-enough-tests"></a></h3>
<p>In this episode, so far we have (only) written tests for two
individual functions: <code>text_to_duration</code> and
<code>calculate_crew_size</code>.</p>
<p>We can quantify the proportion of our code base that is run (also
referred to as “exercised”) by a given test suite using a metric called
code coverage:</p>
<p><span class="math display">\[ \text{Line Coverage} = \left(
\frac{\text{Number of Executed Lines}}{\text{Total Number of Executable
Lines}} \right) \times 100 \]</span></p>
<p>We can calculate our test coverage using the <code>pytest-cov</code>
library as follows.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python3 <span class="at">-m</span> pytest <span class="at">--cov</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>platform darwin -- Python 3.14.0, pytest-9.0.1, pluggy-1.6.0
rootdir: /Users/user/Desktop/spacewalks
plugins: cov-7.0.0
collected 5 items

tests/test_eva_analysis.py .....                                                                                         [100%]

====================================================== 5 passed in 0.93s =======================================================
(venv_spacewalks) mbassan2@Mac spacewalks % python3 -m pytest --cov
===================================================== test session starts ======================================================
platform darwin -- Python 3.14.0, pytest-9.0.1, pluggy-1.6.0
rootdir: /Users/user/Desktop/spacewalks
plugins: cov-7.0.0
collected 5 items

tests/test_eva_analysis.py .....                                                                                         [100%]

======================================================== tests coverage ========================================================
_______________________________________ coverage: platform darwin, python 3.14.0-final-0 _______________________________________

Name                         Stmts   Miss  Cover
------------------------------------------------
eva_data_analysis.py            57     38    33%
tests/test_eva_analysis.py      17      0   100%
------------------------------------------------
TOTAL                           74     38    49%
====================================================== 5 passed in 0.84s =======================================================</code></pre>
</div>
<p>To get an in-depth report about which parts of our code are tested
and which are not, we can add the option
<code>--cov-report=html</code>.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python3 <span class="at">-m</span> pytest <span class="at">--cov</span> <span class="at">--cov-report</span><span class="op">=</span>html </span></code></pre>
</div>
<p>This option generates a folder <code>htmlcov</code> in the project
root directory containing a code coverage report in HTML format. This
provides structured information about our test coverage including:</p>
<ul><li>a table showing the proportion of lines in each function that are
currently tested, and</li>
<li>an annotated copy of our code where untested lines are highlighted
in red.</li>
</ul><p>Ideally, all the lines of code in our code base should be exercised
by at least one test. However, if we lack the time and resources to test
every line of our code we should:</p>
<ul><li>avoid testing Python’s built-in functions or functions imported from
well-known and well-tested libraries like <code>pandas</code> or
<code>numpy</code>.</li>
<li>focus on the the parts of our code that carry the greatest
“reputational risk”, i.e. that could affect the accuracy of our reported
results.</li>
</ul><div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Test coverage of less than 100% indicates that more testing may be
helpful.</p>
<p>Test coverage of 100% does not mean that our code is bug-free.</p>
</div>
</div>
</div>
<div id="evaluating-code-coverage-10-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="evaluating-code-coverage-10-min" class="callout-inner">
<h3 class="callout-title">Evaluating code coverage (10 min)</h3>
<div class="callout-content">
<p>Generate the code coverage report for your software using the
<code>python3 -m pytest --cov --cov-report=html</code> command.</p>
<p>Inspect the <code>htmlcov</code> folder created by the above command
in the root directory of your project, then open the
<code>htmlcov/index.html</code> file in a Web browser and extract the
following information:</p>
<ol style="list-style-type: lower-alpha"><li>What proportion of the code base is currently “not” exercised by the
test suite?</li>
<li>Which functions in our code base are currently untested?</li>
</ol></div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha"><li>You can find this information on the “Files” tab of the HTML report
saved in the <code>htmlcov/index.html</code> file. The proportion of the
code base NOT covered by our tests is 68% (100% - 32%) - this may differ
for your version of the code.</li>
<li>You can find this information on the “Functions” tab of the HTML
report. The following functions in our code base are currently untested:
<ul><li>read_json_to_dataframe</li>
<li>write_dataframe_to_csv</li>
<li>add_duration_hours</li>
<li>plot_cumulative_time_in_space</li>
<li>add_crew_size_variable</li>
</ul></li>
</ol></div>
</div>
</div>
</div>
<p>At this point, now is a good time to commit our test suite to our
codebase and push the changes to GitHub.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git add eva_data_analysis.py </span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git commit <span class="at">-m</span> <span class="st">"Add additional analysis functions"</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git add tests/</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git commit <span class="at">-m</span> <span class="st">"Add test suite"</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python3 <span class="at">-m</span> pip freeze <span class="op">&gt;</span> requirements.txt</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git add requirements.txt</span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git commit <span class="at">-m</span> <span class="st">"Added pytest and pytest-cov libraries."</span></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git push origin main</span></code></pre>
</div>
<div id="support-for-pytest-in-vs-code" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="support-for-pytest-in-vs-code" class="callout-inner">
<h3 class="callout-title">Support for <code>pytest</code> in VS
Code</h3>
<div class="callout-content">
<p>VS Code supports the running of unit tests within its IDE, including
tests written in <code>pytest</code>. To enable this support, you will
first need to configure the <code>pytest</code> framework in VS Code.
Open the <code>Test Explorer</code> view by clicking on the test beaker
icon on the VS Code Activity Bar on the left hand side.</p>
<p>You should see a <code>Configure Python Tests</code> button if a test
framework is not enabled. Clicking on it prompts you to select a test
framework and a folder containing your tests (which in this project, is
the <code>tests</code> subfolder). Tests can also be configured anytime
by using the <code>Python: Configure Tests</code> command from the
Command Palette.</p>
<p>Configuration for the built-in <code>unittest</code> unit testing
framework is also supported; see the specific settings as described in
the <a href="https://code.visualstudio.com/docs/python/testing#_test-configuration-settings" class="external-link">Test
configuration settings of the VS Code documentation for Python</a>.</p>
<p>Once you have configured the test framework to use, you can run tests
either from the <code>Project Explorer</code> or
<code>Test Explorer</code> in the VS Code Activity Bar:</p>
<ul><li>From the <code>Project Explorer</code>, right-click on the test
folder and select <code>Run Tests</code>.</li>
<li>Alternatively, from the <code>Test Explorer</code> view in VS Code
(click on the test beaker icon on the VS Code Activity Bar on the left
hand side), locate <code>eva_data_analysis</code> and hover over it. You
will see a few “run” buttons next to it. Click either the play button
<code>Run Test</code> or the play button with the little check
<code>Run Test with Coverage</code>.</li>
</ul><p>In either case, you should get the test results on the test results
pane at the bottom of the window.</p>
</div>
</div>
</div>
<p>Our <code>eva_data_analysis.py</code> code may now look something
like:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="kw">def</span> main(input_file, output_file, graph_file):</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--START--"</span>)</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>    <span class="co"># Read the data from JSON file</span></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>    eva_data <span class="op">=</span> read_json_to_dataframe(input_file)</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a>    <span class="co"># Calculate and add crew size to data</span></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>    eva_data <span class="op">=</span> add_crew_size_column(eva_data)</span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>    <span class="co"># Convert and export data to CSV file</span></span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a>    write_dataframe_to_csv(eva_data, output_file)</span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>    <span class="co"># Sort dataframe by date ready to be plotted (date values are on x-axis)</span></span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>    eva_data.sort_values(<span class="st">'date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a>    <span class="co"># Plot cumulative time spent in space over years</span></span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>    plot_cumulative_time_in_space(eva_data, graph_file)</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--END--"</span>)</span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a><span class="kw">def</span> read_json_to_dataframe(input_file):</span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a><span class="co">    Read the data from a JSON file into a Pandas dataframe.</span></span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a><span class="co">    Clean the data by removing any rows where the 'duration' value is missing.</span></span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a><span class="co">        input_file (file or str): The file object or path to the JSON file.</span></span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a><span class="co">         eva_df (pd.DataFrame): The cleaned data as a dataframe structure</span></span>
<span id="cb39-38"><a href="#cb39-38" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-39"><a href="#cb39-39" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Reading JSON file </span><span class="sc">{</span>input_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb39-40"><a href="#cb39-40" tabindex="-1"></a>    <span class="co"># Read the data from a JSON file into a Pandas dataframe</span></span>
<span id="cb39-41"><a href="#cb39-41" tabindex="-1"></a>    eva_df <span class="op">=</span> pd.read_json(input_file, convert_dates<span class="op">=</span>[<span class="st">'date'</span>], encoding<span class="op">=</span><span class="st">'ascii'</span>)</span>
<span id="cb39-42"><a href="#cb39-42" tabindex="-1"></a>    eva_df[<span class="st">'eva'</span>] <span class="op">=</span> eva_df[<span class="st">'eva'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb39-43"><a href="#cb39-43" tabindex="-1"></a>    <span class="co"># Clean the data by removing any rows where duration is missing</span></span>
<span id="cb39-44"><a href="#cb39-44" tabindex="-1"></a>    eva_df.dropna(axis<span class="op">=</span><span class="dv">0</span>, subset<span class="op">=</span>[<span class="st">'duration'</span>, <span class="st">'date'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-45"><a href="#cb39-45" tabindex="-1"></a>    <span class="cf">return</span> eva_df</span>
<span id="cb39-46"><a href="#cb39-46" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" tabindex="-1"></a><span class="kw">def</span> write_dataframe_to_csv(df, output_file):</span>
<span id="cb39-49"><a href="#cb39-49" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-50"><a href="#cb39-50" tabindex="-1"></a><span class="co">    Write the dataframe to a CSV file.</span></span>
<span id="cb39-51"><a href="#cb39-51" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-53"><a href="#cb39-53" tabindex="-1"></a><span class="co">        df (pd.DataFrame): The input dataframe.</span></span>
<span id="cb39-54"><a href="#cb39-54" tabindex="-1"></a><span class="co">        output_file (file or str): The file object or path to the output CSV file.</span></span>
<span id="cb39-55"><a href="#cb39-55" tabindex="-1"></a></span>
<span id="cb39-56"><a href="#cb39-56" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-57"><a href="#cb39-57" tabindex="-1"></a><span class="co">        None</span></span>
<span id="cb39-58"><a href="#cb39-58" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-59"><a href="#cb39-59" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Saving to CSV file </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb39-60"><a href="#cb39-60" tabindex="-1"></a>    <span class="co"># Save dataframe to CSV file for later analysis</span></span>
<span id="cb39-61"><a href="#cb39-61" tabindex="-1"></a>    df.to_csv(output_file, index<span class="op">=</span><span class="va">False</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>)</span>
<span id="cb39-62"><a href="#cb39-62" tabindex="-1"></a></span>
<span id="cb39-63"><a href="#cb39-63" tabindex="-1"></a></span>
<span id="cb39-64"><a href="#cb39-64" tabindex="-1"></a><span class="kw">def</span> plot_cumulative_time_in_space(df, graph_file):</span>
<span id="cb39-65"><a href="#cb39-65" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-66"><a href="#cb39-66" tabindex="-1"></a><span class="co">    Plot the cumulative time spent in space over years.</span></span>
<span id="cb39-67"><a href="#cb39-67" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" tabindex="-1"></a><span class="co">    Convert the duration column from strings to number of hours</span></span>
<span id="cb39-69"><a href="#cb39-69" tabindex="-1"></a><span class="co">    Calculate cumulative sum of durations</span></span>
<span id="cb39-70"><a href="#cb39-70" tabindex="-1"></a><span class="co">    Generate a plot of cumulative time spent in space over years and</span></span>
<span id="cb39-71"><a href="#cb39-71" tabindex="-1"></a><span class="co">    save it to the specified location</span></span>
<span id="cb39-72"><a href="#cb39-72" tabindex="-1"></a></span>
<span id="cb39-73"><a href="#cb39-73" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-74"><a href="#cb39-74" tabindex="-1"></a><span class="co">        df (pd.DataFrame): The input dataframe.</span></span>
<span id="cb39-75"><a href="#cb39-75" tabindex="-1"></a><span class="co">        graph_file (file or str): The file object or path to the output graph file.</span></span>
<span id="cb39-76"><a href="#cb39-76" tabindex="-1"></a></span>
<span id="cb39-77"><a href="#cb39-77" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-78"><a href="#cb39-78" tabindex="-1"></a><span class="co">        None</span></span>
<span id="cb39-79"><a href="#cb39-79" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-80"><a href="#cb39-80" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Plotting cumulative spacewalk duration and saving to </span><span class="sc">{</span>graph_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb39-81"><a href="#cb39-81" tabindex="-1"></a>    df <span class="op">=</span> add_duration_hours(df)</span>
<span id="cb39-82"><a href="#cb39-82" tabindex="-1"></a>    df[<span class="st">'cumulative_time'</span>] <span class="op">=</span> df[<span class="st">'duration_hours'</span>].cumsum()</span>
<span id="cb39-83"><a href="#cb39-83" tabindex="-1"></a>    plt.plot(df[<span class="st">'date'</span>], df[<span class="st">'cumulative_time'</span>], <span class="st">'ko-'</span>)</span>
<span id="cb39-84"><a href="#cb39-84" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb39-85"><a href="#cb39-85" tabindex="-1"></a>    plt.ylabel(<span class="st">'Total time spent in space to date (hours)'</span>)</span>
<span id="cb39-86"><a href="#cb39-86" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb39-87"><a href="#cb39-87" tabindex="-1"></a>    plt.savefig(graph_file)</span>
<span id="cb39-88"><a href="#cb39-88" tabindex="-1"></a>    plt.show()</span>
<span id="cb39-89"><a href="#cb39-89" tabindex="-1"></a></span>
<span id="cb39-90"><a href="#cb39-90" tabindex="-1"></a></span>
<span id="cb39-91"><a href="#cb39-91" tabindex="-1"></a><span class="kw">def</span> text_to_duration(duration):</span>
<span id="cb39-92"><a href="#cb39-92" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-93"><a href="#cb39-93" tabindex="-1"></a><span class="co">    Convert a text format duration "HH:MM" to duration in hours</span></span>
<span id="cb39-94"><a href="#cb39-94" tabindex="-1"></a></span>
<span id="cb39-95"><a href="#cb39-95" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-96"><a href="#cb39-96" tabindex="-1"></a><span class="co">        duration (str): The text format duration</span></span>
<span id="cb39-97"><a href="#cb39-97" tabindex="-1"></a></span>
<span id="cb39-98"><a href="#cb39-98" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-99"><a href="#cb39-99" tabindex="-1"></a><span class="co">        duration_hours (float): The duration in hours</span></span>
<span id="cb39-100"><a href="#cb39-100" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-101"><a href="#cb39-101" tabindex="-1"></a>    hours, minutes <span class="op">=</span> duration.split(<span class="st">":"</span>)</span>
<span id="cb39-102"><a href="#cb39-102" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">60</span></span>
<span id="cb39-103"><a href="#cb39-103" tabindex="-1"></a>    <span class="cf">return</span> duration_hours</span>
<span id="cb39-104"><a href="#cb39-104" tabindex="-1"></a></span>
<span id="cb39-105"><a href="#cb39-105" tabindex="-1"></a></span>
<span id="cb39-106"><a href="#cb39-106" tabindex="-1"></a><span class="kw">def</span> add_duration_hours(df):</span>
<span id="cb39-107"><a href="#cb39-107" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-108"><a href="#cb39-108" tabindex="-1"></a><span class="co">    Add duration in hours (duration_hours) variable to the dataset</span></span>
<span id="cb39-109"><a href="#cb39-109" tabindex="-1"></a></span>
<span id="cb39-110"><a href="#cb39-110" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-111"><a href="#cb39-111" tabindex="-1"></a><span class="co">        df (pd.DataFrame): The input dataframe.</span></span>
<span id="cb39-112"><a href="#cb39-112" tabindex="-1"></a></span>
<span id="cb39-113"><a href="#cb39-113" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-114"><a href="#cb39-114" tabindex="-1"></a><span class="co">        df_copy (pd.DataFrame): A copy of the dataframe df with the new crew_size variable added</span></span>
<span id="cb39-115"><a href="#cb39-115" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-116"><a href="#cb39-116" tabindex="-1"></a>    df_copy <span class="op">=</span> df.copy()</span>
<span id="cb39-117"><a href="#cb39-117" tabindex="-1"></a>    df_copy[<span class="st">"duration_hours"</span>] <span class="op">=</span> df_copy[<span class="st">"duration"</span>].<span class="bu">apply</span>(</span>
<span id="cb39-118"><a href="#cb39-118" tabindex="-1"></a>        text_to_duration</span>
<span id="cb39-119"><a href="#cb39-119" tabindex="-1"></a>    )</span>
<span id="cb39-120"><a href="#cb39-120" tabindex="-1"></a>    <span class="cf">return</span> df_copy</span>
<span id="cb39-121"><a href="#cb39-121" tabindex="-1"></a></span>
<span id="cb39-122"><a href="#cb39-122" tabindex="-1"></a></span>
<span id="cb39-123"><a href="#cb39-123" tabindex="-1"></a><span class="kw">def</span> calculate_crew_size(crew):</span>
<span id="cb39-124"><a href="#cb39-124" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-125"><a href="#cb39-125" tabindex="-1"></a><span class="co">    Calculate the size of the crew for a single crew entry</span></span>
<span id="cb39-126"><a href="#cb39-126" tabindex="-1"></a></span>
<span id="cb39-127"><a href="#cb39-127" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-128"><a href="#cb39-128" tabindex="-1"></a><span class="co">        crew (str): The text entry in the crew column containing a list of crew member names</span></span>
<span id="cb39-129"><a href="#cb39-129" tabindex="-1"></a></span>
<span id="cb39-130"><a href="#cb39-130" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-131"><a href="#cb39-131" tabindex="-1"></a><span class="co">        (int): The crew size</span></span>
<span id="cb39-132"><a href="#cb39-132" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-133"><a href="#cb39-133" tabindex="-1"></a>    <span class="cf">if</span> crew.split() <span class="op">==</span> []:</span>
<span id="cb39-134"><a href="#cb39-134" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb39-135"><a href="#cb39-135" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-136"><a href="#cb39-136" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(re.split(<span class="vs">r';'</span>, crew))<span class="op">-</span><span class="dv">1</span></span>
<span id="cb39-137"><a href="#cb39-137" tabindex="-1"></a></span>
<span id="cb39-138"><a href="#cb39-138" tabindex="-1"></a><span class="kw">def</span> add_crew_size_column(df):</span>
<span id="cb39-139"><a href="#cb39-139" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-140"><a href="#cb39-140" tabindex="-1"></a><span class="co">    Add crew_size column to the dataset containing the value of the crew size</span></span>
<span id="cb39-141"><a href="#cb39-141" tabindex="-1"></a></span>
<span id="cb39-142"><a href="#cb39-142" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-143"><a href="#cb39-143" tabindex="-1"></a><span class="co">        df (pd.DataFrame): The input data frame.</span></span>
<span id="cb39-144"><a href="#cb39-144" tabindex="-1"></a></span>
<span id="cb39-145"><a href="#cb39-145" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-146"><a href="#cb39-146" tabindex="-1"></a><span class="co">        df_copy (pd.DataFrame): A copy of the dataframe df with the new crew_size variable added</span></span>
<span id="cb39-147"><a href="#cb39-147" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-148"><a href="#cb39-148" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Adding crew size variable (crew_size) to dataset'</span>)</span>
<span id="cb39-149"><a href="#cb39-149" tabindex="-1"></a>    df_copy <span class="op">=</span> df.copy()</span>
<span id="cb39-150"><a href="#cb39-150" tabindex="-1"></a>    df_copy[<span class="st">"crew_size"</span>] <span class="op">=</span> df_copy[<span class="st">"crew"</span>].<span class="bu">apply</span>(</span>
<span id="cb39-151"><a href="#cb39-151" tabindex="-1"></a>        calculate_crew_size</span>
<span id="cb39-152"><a href="#cb39-152" tabindex="-1"></a>    )</span>
<span id="cb39-153"><a href="#cb39-153" tabindex="-1"></a>    <span class="cf">return</span> df_copy</span>
<span id="cb39-154"><a href="#cb39-154" tabindex="-1"></a></span>
<span id="cb39-155"><a href="#cb39-155" tabindex="-1"></a></span>
<span id="cb39-156"><a href="#cb39-156" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb39-157"><a href="#cb39-157" tabindex="-1"></a></span>
<span id="cb39-158"><a href="#cb39-158" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sys.argv) <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb39-159"><a href="#cb39-159" tabindex="-1"></a>        input_file <span class="op">=</span> <span class="st">'data/eva-data.json'</span></span>
<span id="cb39-160"><a href="#cb39-160" tabindex="-1"></a>        output_file <span class="op">=</span> <span class="st">'results/eva-data.csv'</span></span>
<span id="cb39-161"><a href="#cb39-161" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Using default input and output filenames'</span>)</span>
<span id="cb39-162"><a href="#cb39-162" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-163"><a href="#cb39-163" tabindex="-1"></a>        input_file <span class="op">=</span> sys.argv[<span class="dv">1</span>]</span>
<span id="cb39-164"><a href="#cb39-164" tabindex="-1"></a>        output_file <span class="op">=</span> sys.argv[<span class="dv">2</span>]</span>
<span id="cb39-165"><a href="#cb39-165" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Using custom input and output filenames'</span>)</span>
<span id="cb39-166"><a href="#cb39-166" tabindex="-1"></a></span>
<span id="cb39-167"><a href="#cb39-167" tabindex="-1"></a>    graph_file <span class="op">=</span> <span class="st">'results/cumulative_eva_graph.png'</span></span>
<span id="cb39-168"><a href="#cb39-168" tabindex="-1"></a></span>
<span id="cb39-169"><a href="#cb39-169" tabindex="-1"></a>    main(input_file, output_file, graph_file)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="optional-more-practice-with-a-test-suite">(Optional) More practice with a test suite<a class="anchor" aria-label="anchor" href="#optional-more-practice-with-a-test-suite"></a></h3>
<p>There is an <a href="test-suite-exercise.html">optional exercise</a>
to implement additional tests and practice writing tests some more.</p>
</div>
</section><section><h2 class="section-heading" id="continuous-integration-for-automated-testing">Continuous Integration for automated testing<a class="anchor" aria-label="anchor" href="#continuous-integration-for-automated-testing"></a></h2>
<hr class="half-width"><p>Continuous Integration (CI) services provide the infrastructure to
automatically run every test function in the test code suite every time
changes are pushed to a remote repository. There is an <a href="ci-for-testing.html">extra episode on configuring CI for automated
tests on GitHub</a> for some additional reading.</p>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<hr class="half-width"><p>During this episode, we have covered how to use software tests to
verify the correctness of our code. We have seen how to write a unit
test, how to manage and run our tests using the <code>pytest</code>
framework and how identify which parts of our code require additional
testing using test coverage reports.</p>
<p>These skills reduce the probability that there will be a mistake in
our code and support reproducible research by giving us the confidence
to engage in open research practices. Tests also document the intended
behaviour of our code for other developers and allow us to safely
experiment with changes to our code, knowing that our tests will tell us
if we break any existing functionality. In other words, software testing
supports building better software by making our code more
<strong>accessible</strong> and <strong>reusable</strong>.</p>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Code state </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<p>At this point, the code in your local software project’s directory
should be as in: <a href="https://github.com/carpentries-incubator/bbrs-software-project/tree/07-software-documentation" class="external-link uri">https://github.com/carpentries-incubator/bbrs-software-project/tree/07-software-documentation</a>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a></h2>
<hr class="half-width"><p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul><li>
<a href="https://swcarpentry.github.io/python-novice-inflammation/10-defensive.html" class="external-link">The
Defensive Programming episode</a> from the Software Carpentry Python
Programming lesson</li>
<li>
<a href="https://www.software.ac.uk/blog/using-python-double-check-your-work" class="external-link">Using
Python to double check your work</a> (Software Sustainability Blog Post)
by Peter Inglesby</li>
<li>
<a href="https://carpentries-incubator.github.io/python-testing/" class="external-link">The
Python Testing and Continuous Integration</a> lesson on The Carpentries
Incubator by François Michonneau</li>
<li>
<a href="https://researchcodingclub.github.io/2019-11-13-test-driven-development/" class="external-link">Test
Driven Development</a> (University of York Research Coding Club Blog
Post) by Peter Hill and Stephen Biggs-Fox</li>
<li>
<a href="https://coderefinery.github.io/testing/" class="external-link">Automated testing
- Preventing yourself and others from breaking your functioning code</a>
Coderefinery lesson</li>
<li>
<a href="https://carpentries-incubator.github.io/python-intermediate-development/21-automatically-testing-software/index.html" class="external-link">The
Automatically Testing Software episode</a> from the Intermediate
Research Software Development lesson on The Carpentries Incubator by
Aleksandra Nenadic et al.</li>
</ul><p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ol style="list-style-type: decimal"><li>Code testing supports building better software by improving the
accessibility and re-usability of research code.</li>
<li>Unit testing is crucial as it ensures each function works
correctly.</li>
<li>Using the <code>pytest</code> framework, you can write basic unit
tests for Python functions to verify their correctness.</li>
<li>Identifying and handling edge cases in unit tests is essential to
ensure your code performs correctly under a variety of conditions.</li>
<li>Test coverage can help you to identify parts of your code that
require additional testing.</li>
</ol></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-code-structure.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-software-documentation.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-code-structure.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code structure
        </a>
        <a class="chapter-link float-end" href="07-software-documentation.html" rel="next">
          Next: Software...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/better-research-software/edit/main/episodes/06-code-correctness.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/better-research-software/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/better-research-software/" class="external-link">Source</a></p>
        <p>
        <a href="citation.html">Cite</a>
        | <a href="mailto:a.nenadic@software.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
		</div>
		<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.3" class="external-link">sandpaper (0.17.3)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.9" class="external-link">varnish (1.0.9)</a></p>
		</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://carpentries-incubator.github.io/better-research-software/06-code-correctness.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "research software, good practices, FAIR, reproducibility, sustainability, open, research, lesson, The Carpentries",
  "name": "Code correctness &amp;amp; testing",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/better-research-software/06-code-correctness.html",
  "identifier": "https://carpentries-incubator.github.io/better-research-software/06-code-correctness.html",
  "dateCreated": "2023-10-03",
  "dateModified": "2025-12-05",
  "datePublished": "2025-12-05"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

